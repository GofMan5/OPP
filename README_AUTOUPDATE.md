# Инструкция по настройке автоматического обновления

Для работы системы автоматического обновления необходимо выполнить следующие шаги:

## 1. Настройка файла информации об обновлениях

1. Создайте JSON файл `update_info.json` по следующему шаблону:

```json
{
  "Version": "1.0.1",
  "ReleaseDate": "2023-10-15",
  "Mandatory": false,
  "DownloadUrl": "https://example.com/downloads/OPP_Setup_1.0.1.exe",
  "ChangelogUrl": "https://example.com/changelog/1.0.1.txt",
  "MinOSVersion": "10.0",
  "FileSize": 15360000,
  "UpdateMessages": {
    "Ru": "Доступно обновление до версии 1.0.1. Рекомендуется установить для улучшения стабильности.",
    "En": "Update to version 1.0.1 is available. It's recommended to install for improved stability."
  }
}
```

2. Загрузите этот файл на ваш веб-сервер или облачное хранилище (Google Drive, Dropbox, GitHub и т.п.).

3. Получите прямую ссылку на этот файл.

4. Обновите константу `VERSION_CHECK_URL` в классе `UpdateManager` (файл `App/Helpers/UpdateManager.cs`) на вашу ссылку.

## 2. Подготовка установщика Inno Setup

1. Каждый раз при выпуске новой версии обновляйте номер версии в файле `OPP_Setup.iss`:

```
#define MyAppVersion "1.0.1"  // Меняйте на актуальную версию
```

2. Скомпилируйте установщик с помощью Inno Setup Compiler.

3. Загрузите скомпилированный файл установщика (из папки `Output`) на ваш сервер.

4. Обновите ссылку `DownloadUrl` в файле `update_info.json`, чтобы она указывала на новый установщик.

## 3. Подготовка списка изменений (опционально)

1. Создайте текстовый файл с описанием изменений в новой версии.

2. Загрузите этот файл на ваш сервер.

3. Обновите ссылку `ChangelogUrl` в файле `update_info.json`.

## 4. Тестирование обновления

1. Установите старую версию приложения на тестовую машину.

2. Обновите информацию в `update_info.json` на вашем сервере.

3. Запустите приложение и убедитесь, что оно обнаруживает обновление.

4. Протестируйте процесс загрузки и установки обновления.

## Особенности работы системы обновлений

- Приложение проверяет наличие обновлений при запуске (если эта опция включена в настройках).
- Пользователь может вручную проверить наличие обновлений через меню приложения.
- Если обновление помечено как обязательное (`"Mandatory": true`), пользователю не будет предоставлен выбор - обновление будет установлено автоматически.
- После установки обновления приложение автоматически перезапустится.

## Решение проблем

1. Если обновление не обнаруживается:
   - Проверьте доступность файла `update_info.json` по указанной ссылке.
   - Убедитесь, что версия в файле больше, чем текущая версия приложения.

2. Если обновление не загружается:
   - Проверьте доступность файла установщика по ссылке в `DownloadUrl`.
   - Проверьте лог приложения на наличие ошибок.

3. Если установщик не запускается после загрузки:
   - Убедитесь, что у пользователя есть необходимые права для запуска установщика.
   - Проверьте, не блокирует ли антивирус запуск установщика. 